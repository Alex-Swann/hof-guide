<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>HOF Documentation</title>

    <!--[if gt IE 8]><!--><link href="/hof-guide/stylesheets/screen.css" rel="stylesheet" media="screen" /><!--<![endif]-->
    <!--[if lte IE 8]><link href="/hof-guide/stylesheets/screen-old-ie.css" rel="stylesheet" media="screen" /><![endif]-->

    <link rel="canonical" href="ukhomeofficeforms.github.io/hof-guide/hof-guide/documentation/">

    <link href="/hof-guide/stylesheets/print.css" rel="stylesheet" media="print" />
    <script src="/hof-guide/javascripts/application.js"></script>
  </head>

  <body>
    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="skip-link">Skip to main content</a>

        <header class="header header--full-width">
  <div class="header__container">
    <div class="header__brand">
        <a href="https://ukhomeofficeforms.github.io/hof-guide">
          <span class="govuk-logo">
            <img class="govuk-logo__printable-crown" src="/images/gov.uk_logotype_crown_invert_trans.png" height="32" width="36">
            GOV.UK
          </span>
        <span class="header__title">
          Home Office Forms
            <span class="phase-banner">Beta</span>
        </span>
        </a>
    </div>

      <div data-module="navigation">
        <button type="button" class="header__navigation-toggle js-nav-toggle" aria-controls="navigation" aria-label="Show or hide top level navigation">Menu</button>

        <nav id="navigation" class="header__navigation js-nav" aria-label="Top Level Navigation" aria-hidden="true">
          <ul>
              <li>
                <a href="/hof-guide/">
                  About
                </a>
              </li>
              <li>
                <a href="/hof-guide/documentation/">
                  Documentation
                </a>
              </li>
          </ul>
        </nav>
      </div>
  </div>
</header>

      </div>

      <div id="toc-heading" class="toc-show fixedsticky">
        <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
          Table of contents <span class="toc-show__icon"></span>
        </a>
      </div>

      <div class="app-pane__body" data-module="in-page-navigation">
        <div class="app-pane__toc">
          <div class="toc" data-module="table-of-contents">
            <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
            <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
              <ul>
  <li>
    <a href="#getting-started">Getting Started</a>
    <ul>
      <li>
        <a href="#preamble">Preamble</a>
      </li>
      <li>
        <a href="#requirements">Requirements</a>
      </li>
      <li>
        <a href="#building-your-first-hof-form">Building your first hof form</a>
        <ul>
          <li>
            <a href="#installing-the-hof-cli">Installing the hof cli</a>
          </li>
          <li>
            <a href="#creating-your-first-form">Creating your first form</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="#basic-form-customisation">Basic Form Customisation</a>
    <ul>
      <li>
        <a href="#adding-steps">Adding Steps</a>
      </li>
      <li>
        <a href="#adding-fields">Adding Fields</a>
        <ul>
          <li>
            <a href="#configuring-fields">Configuring Fields</a>
            <ul>
              <li>
                <a href="#validation-rules">Validation Rules</a>
              </li>
              <li>
                <a href="#field-types">Field Types</a>
              </li>
              <li>
                <a href="#field-labels">Field Labels</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="#content-and-i18n">Content and i18n</a>
    <ul>
      <li>
        <a href="#default-application-content">Default application content</a>
        <ul>
          <li>
            <a href="#journey">journey</a>
          </li>
          <li>
            <a href="#pages">pages</a>
          </li>
          <li>
            <a href="#fields">fields</a>
            <ul>
              <li>
                <a href="#options">options</a>
              </li>
              <li>
                <a href="#validation-messaging">Validation messaging</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <a href="#free-text-content">Free text content</a>
      </li>
      <li>
        <a href="#adding-languages">Adding languages</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="#customising-behaviour">Customising Behaviour</a>
    <ul>
      <li>
        <a href="#the-request-pipeline">The request pipeline</a>
        <ul>
          <li>
            <a href="#get">GET</a>
          </li>
          <li>
            <a href="#post">POST</a>
            <ul>
              <li>
                <a href="#configure">configure</a>
              </li>
              <li>
                <a href="#getvalues">getValues</a>
              </li>
              <li>
                <a href="#locals">locals</a>
              </li>
              <li>
                <a href="#render">render</a>
              </li>
              <li>
                <a href="#process">process</a>
              </li>
              <li>
                <a href="#validate">validate</a>
              </li>
              <li>
                <a href="#savevalues">saveValues</a>
              </li>
              <li>
                <a href="#successhandler">successHandler</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#sessions">Sessions</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#behaviours">Behaviours</a>
        <ul>
          <li>
            <a href="#writing-a-behaviour">Writing a behaviour</a>
          </li>
          <li>
            <a href="#configurable-behaviours">Configurable behaviours</a>
          </li>
          <li>
            <a href="#completion-behaviour">Completion behaviour</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="#api-integration">API integration</a>
  </li>
  <li>
    <a href="#contributing-to-hof">Contributing to HOF</a>
  </li>
</ul>

            </nav>
          </div>
        </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="getting-started">Getting Started</h1><h2 id="preamble">Preamble</h2>
<p>It is expected when following these guides that you have a basic knowledge of unix terminals and are running OSX or a Linux operating system.</p>

<p>It is also expected that you have a working knowledge of javascript and node.js and are comfortable installing packages from npm. You should also be comfortable working with git.</p>

<p>This documentation is written with the assumption that you are using the latest versions of hof modules. Not all of this documentation will be relevant if you are not using the latest versions.</p>
<h2 id="requirements">Requirements</h2>
<p>hof is built in <a href="https://nodejs.org/en/">node.js</a>, and so you&rsquo;ll need that installed first. At present all versions 4 and above are supported, although it is recommended that you use the <a href="https://github.com/nodejs/LTS#lts-schedule">latest LTS version</a>.</p>

<p>hof also requires npm version 3 or greater. You can check your installed version by running <code>npm -v</code> and update to the latest version by running <code>npm install -g npm@latest</code>.</p>

<p>To run hof apps locally for development you will either need a local instance of redis running, or docker installed.</p>

<ul>
<li>How to <a href="https://medium.com/@petehouston/install-and-config-redis-on-mac-os-x-via-homebrew-eb8df9a4f298#.jcwwhv7oz">install redis on OSX</a></li>
<li>How to <a href="https://docs.docker.com/docker-for-mac/install/#install-and-run-docker-for-mac">install docker on OSX</a></li>
</ul>
<h2 id="building-your-first-hof-form">Building your first hof form</h2>
<p>The fastest way to create a new hof app is to use the <a href="https://npmjs.com/hof-generator"><code>hof</code> command line generator</a>. This will automatically create a bare-bones hof form in a directory of your choice.</p>
<h3 id="installing-the-hof-cli">Installing the hof cli</h3>
<p>Install the cli from npm:</p>
<pre class="highlight plaintext"><code>npm install -g hof-generator
</code></pre><h3 id="creating-your-first-form">Creating your first form</h3><pre class="highlight plaintext"><code>mkdir my-hof-form
cd my-hof-form
hof init
</code></pre>
<p>This will generate a brand new hof app in the directory you created.</p>

<p>You can then start your app by running <code>docker-compose up</code> or <code>npm start</code> (needs local redis instance).</p>

<p>If you open <a href="http://localhost:8080/my-hof-form">http://localhost:8080/my-hof-form</a> in a browser then you should see your app. It should look something like this:</p>

<p><a href="../images/getting-started.png" target="_blank" rel="noopener noreferrer"><img src="/hof-guide/images/../images/getting-started.png" alt="Getting started" /></a></p>

<h1 id="basic-form-customisation">Basic Form Customisation</h1>

<p>Now we have a basic form created then the next job is to add some steps and fields to our new form.</p>

<p>In the directory we just created we should now find a directory <code>./apps/my-hof-form</code>. This contains the configuration and code for our app.</p>

<p>Its contents should look something like this:</p>

<pre class="highlight plaintext"><code>apps/my-hof-form/
├── fields/
├── translations/
└── index.js
</code></pre><h2 id="adding-steps">Adding Steps</h2>
<p>Open the index.js file in a text editor. You will see a steps configuration that looks like this:</p>
<pre class="highlight javascript"><code><span class="nx">steps</span><span class="p">:</span> <span class="p">{</span>
  <span class="s1">'/name'</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">],</span>
    <span class="nx">next</span><span class="p">:</span> <span class="s1">'/confirm'</span>
  <span class="p">},</span>
  <span class="s1">'/confirm'</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">behaviours</span><span class="p">:</span> <span class="p">[</span><span class="s1">'complete'</span><span class="p">,</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hof-behaviour-summary-page'</span><span class="p">)],</span>
    <span class="nx">next</span><span class="p">:</span> <span class="s1">'/complete'</span>
  <span class="p">},</span>
  <span class="s1">'/complete'</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre>

<p>This defines the steps that our form takes, and the fields which are displayed on those steps.</p>

<p>The keys of the <code>steps</code> object define the urls for each step.</p>

<p>The basic configuration options you need to add a step can be seen on the <code>/name</code> step. The <code>fields</code> option defines which fields will be displayed, and the <code>next</code> option defines the step to which the user is taken when they complete the step.</p>

<p>To add a new step between <code>/name</code> and <code>/confirm</code> to collect a user&rsquo;s address we add a child object with a key of <code>/address</code> to the steps object.</p>

<p>Since it is going between <code>/name</code> and <code>/confirm</code> it should have a <code>next</code> property of <code>/confirm</code>, and we should modify the <code>next</code> property of the <code>/name</code> step to <code>/address</code>.</p>

<pre class="highlight javascript"><code><span class="nx">steps</span><span class="p">:</span> <span class="p">{</span>
  <span class="s1">'/name'</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">],</span>
    <span class="nx">next</span><span class="p">:</span> <span class="s1">'/address'</span>
  <span class="p">},</span>
  <span class="s1">'/address'</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">next</span><span class="p">:</span> <span class="s1">'/confirm'</span>
    <span class="p">},</span>
  <span class="s1">'/confirm'</span><span class="p">:</span> <span class="p">{</span>
  <span class="p">...</span>
</code></pre>

<p>Now if you restart your server (<code>Ctrl+C</code> to stop, then run the same command again) and go back to your form in the browser you will see that when you complete the <code>/name</code> step you are taken to <code>/address</code>.</p>

<h2 id="adding-fields">Adding Fields</h2>

<p>Now we need to add some fields to our new address step. This is as simple as adding the keys for those fields to the <code>fields</code> property of our new step object.</p>

<p>We&rsquo;ll add five fields to this step to collect a full address.</p>

<pre class="highlight javascript"><code><span class="nx">steps</span><span class="p">:</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="s1">'/address'</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'address-line-1'</span><span class="p">,</span> <span class="s1">'address-line-2'</span><span class="p">,</span> <span class="s1">'town'</span><span class="p">,</span> <span class="s1">'country'</span><span class="p">,</span> <span class="s1">'postcode'</span><span class="p">],</span>
    <span class="nx">next</span><span class="p">:</span> <span class="s1">'/confirm'</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre>

<p>Returning to the app in a browser and refreshing (you will need to restart your server each time you make changes - you can have this happen automatically when running locally by running <code>npm run start:dev</code> to start your server, which is recommended when you&rsquo;re developing an app) you will now see these fields on the address page.</p>

<h3 id="configuring-fields">Configuring Fields</h3><h4 id="validation-rules">Validation Rules</h4>
<p>The next job is to configure the validation rules for our new fields. The configuration for this can be found in <code>./fields/index.js</code> in our app directory.</p>

<p>You will see existing configuration for the <code>name</code> field that&rsquo;s already in our app. We can add new config objects for each of our new fields to this.</p>
<pre class="highlight javascript"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">validate</span><span class="p">:</span> <span class="s1">'required'</span>
  <span class="p">},</span>
  <span class="s1">'address-line-1'</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s1">'address-line-2'</span><span class="p">:</span> <span class="p">{},</span>
  <span class="na">town</span><span class="p">:</span> <span class="p">{},</span>
  <span class="na">country</span><span class="p">:</span> <span class="p">{},</span>
  <span class="na">postcode</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">};</span>
</code></pre>
<p>We want to make all of the fields except <code>address-line-2</code> mandatory, and so can give them a <code>validate</code> property of <code>&#39;required&#39;</code>.</p>
<pre class="highlight javascript"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">validate</span><span class="p">:</span> <span class="s1">'required'</span>
  <span class="p">},</span>
  <span class="s1">'address-line-1'</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">validate</span><span class="p">:</span> <span class="s1">'required'</span>
  <span class="p">},</span>
  <span class="s1">'address-line-2'</span><span class="p">:</span> <span class="p">{},</span>
  <span class="na">town</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">validate</span><span class="p">:</span> <span class="s1">'required'</span>
  <span class="p">},</span>
  <span class="na">country</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">validate</span><span class="p">:</span> <span class="s1">'required'</span>
  <span class="p">},</span>
  <span class="na">postcode</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">validate</span><span class="p">:</span> <span class="s1">'required'</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
<p>Additionally, we might want to do validation on the postcode to make sure it is correctly formatted, and so we can add an additional <code>postcode</code> validator. To add multiple validators to a field, simply set the validate property to an array.</p>
<pre class="highlight javascript"><code><span class="nx">postcode</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">validate</span><span class="p">:</span> <span class="p">[</span><span class="s1">'required'</span><span class="p">,</span> <span class="s1">'postcode'</span><span class="p">]</span>
<span class="p">}</span>
</code></pre>
<ul>
<li><a href="https://github.com/UKHomeOfficeForms/hof-form-controller/blob/master/lib/validation/validators.js">full list of built-in validation types</a></li>
</ul>
<h4 id="field-types">Field Types</h4>
<p>By default all fields are <code>input[type=text]</code> unless otherwise specified. In this case, we possibly want our country field to be a <code>select</code> element instead.</p>

<p>To do this we add a <code>mixin</code> property of <code>select</code> to that field.</p>
<pre class="highlight javascript"><code><span class="nx">country</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">mixin</span><span class="p">:</span> <span class="s1">'select'</span><span class="p">,</span>
  <span class="nx">validate</span><span class="p">:</span> <span class="s1">'required'</span>
<span class="p">}</span>
</code></pre>
<p>We also need to add some options for the field. Fortunately there is a Home Office managed list of countries, so we don&rsquo;t need to handle this ourselves. Install <code>hof-util-countries</code> from npm, and then add the following:</p>
<pre class="highlight javascript"><code><span class="nx">country</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">mixin</span><span class="p">:</span> <span class="s1">'select'</span><span class="p">,</span>
  <span class="nx">options</span><span class="p">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'hof-util-countries'</span><span class="p">)(),</span>
  <span class="nx">validate</span><span class="p">:</span> <span class="s1">'required'</span>
<span class="p">}</span>
</code></pre>
<p>For more <code>mixin</code> options and field configuration settings see <a href="https://npmjs.com/hof-template-mixins">hof-template-mixins</a>.</p>
<h4 id="field-labels">Field Labels</h4>
<p>The last thing to do is to add some label content for our new fields. You will see that right now they appear with default labels like <code>fields.address-line-1.label</code>.</p>

<p>To add label content for our new fields we need to set some properties in <code>./translations/src/en/fields.json</code>. You will see here that there is a label defined for the name field. We can add some more labels for our new fields as follows:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"address-line-1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Address"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"address-line-2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Address line 2"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"town"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Town"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Country"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"postcode"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Postcode"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Returning to your app in a browser you will now see that the new address fields now use the labels we defined for them.</p>

<blockquote>
<p><a href="#fields">more information about how the content for fields can be configured</a></p>
</blockquote>

<h1 id="content-and-i18n">Content and i18n</h1>
<p>hof comes with multi-language support out-of-the-box.</p>

<p>It uses a translation library to load content from a set of language specific json files to display in your app.</p>
<h2 id="default-application-content">Default application content</h2>
<p>If you have used the <code>hof-generator</code> to initialise your application you will see a translations directory at <code>./apps/my-hof-app/translations</code> with something like the following file structure:</p>
<pre class="highlight plaintext"><code>apps/my-hof-form/translations
└─┬ src/
  └─┬ en/
    ├── fields.json
    ├── journey.json
    └── pages.json
</code></pre>
<p>These json files contain the translated content for the following application features.</p>
<h3 id="journey">journey</h3>

<p>This contains the application-wide content that applies to all pages in your application. In most cases this is only the application title as shown in the header bar.</p>

<h3 id="pages">pages</h3>

<p>This contains page-specific content for each page of your app. The top level keys in <code>pages.json</code> correspond to the routes onto which your steps are mounted, as defined in your application config.</p>

<p>For example, to add the content for the address step we created earlier at <code>/address</code> then you would add the following to your <code>pages.json</code>:</p>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"header"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Personal details"</span><span class="p">,</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"header"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Address details"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The key for each section of the <code>pages.json</code> file should match the url path of the step.</p>

<p>By default a <code>header</code> and optional <code>intro</code> are loaded for each page. If you are using a custom template for a page then you might wish to define further page-level translations here.</p>

<h3 id="fields">fields</h3>

<p>This contains the content for each field, with the keys as per the field names in your fields configuration.</p>

<p>The properties available for each field vary slightly according to the field type, but the following are standard:</p>

<ul>
<li><code>label</code> - defines the label element text for text inputs and select boxes</li>
<li><code>legend</code> - defines the legend text for radio and checkbox groups</li>
<li><code>hint</code> - provides an optional help message</li>
<li><code>options</code> - defines the options available for select elements and radio and checkbox groups</li>
</ul>

<h4 id="options">options</h4>

<p>The <code>options</code> translation for a radio/checkbox group or select element should consist of a label for each option as defined in the options for the field. For example, for a yes/no radio button group:</p>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"resident-in-uk"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"legend"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Are you permanently resident in the United Kingdom?"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"yes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Yes"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"no"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h4 id="validation-messaging">Validation messaging</h4>
<p>The validation messages applicable to a field can also be defined as part of the field&rsquo;s translation by defining a <code>validation</code> object as part of the field&rsquo;s translation. For example - for an email input:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"email-address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email address"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"validation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"required"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Please enter an email address"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Please enter a valid email address containing an '@' symbol"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This will then display the appropriate error message depending on the <a href="https://github.com/UKHomeOfficeForms/hof-form-controller/blob/master/lib/validation/validators.js">validation type</a> which has failed.</p>

<p>Depending on the type of validator which has failed, certain variables are available for use in messages.</p>

<ul>
<li><code>maxlength</code>/<code>minlength</code>/<code>exactlength</code> - expose the value of the length parameter as a variable with the same name - e.g. <code>&quot;Please enter at least {{minlength}} characters&quot;</code></li>
<li><code>before</code>/<code>after</code> - expose a <code>diff</code> property, which contains a stringified version of the limit - e.g. <code>&#39;5 years&#39;</code>, <code>&#39;3 months&#39;</code></li>
</ul>

<p>If you wish to define global fallback messages for particular validation types then you can create a <code>validation.json</code> which will be used if no field-specific messages are present.</p>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"required"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This field is required"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"minlength"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enter at least {{minlength}} characters"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id="free-text-content">Free text content</h2>
<p>In cases where the content is more complex than simple strings, then free text content can be loaded in markdown format by using the <code>markdown</code> mixin in your page templates.</p>

<p>In your application&rsquo;s <code>views</code> directory, create the following folder structure:</p>
<pre class="highlight plaintext"><code>apps/my-hof-form/views
└─┬ content/
  └─┬ en/
    └── free-text-content.md
</code></pre>

<p>In your page template you can then include <code>{{#markdown}}free-text-content{{/markdown}}</code> and the rendered markdown content of that file will be included in your page.</p>

<h2 id="adding-languages">Adding languages</h2>

<p>Adding support for a second language is then simply a case of duplcating your json and markdown files from an <code>en</code> directory into directories corresponding to the language code of the language you wish to add.</p>

<p>So to add Welsh language support you would copy the <code>en</code> directory to a <code>cy</code> directory resulting in the following file structure:</p>

<pre class="highlight plaintext"><code>apps/my-hof-form/translations
└─┬ src/
  ├─┬ en/
  │ ├── fields.json
  │ ├── journey.json
  │ └── pages.json
  └─┬ cy/
    ├── fields.json
    ├── journey.json
    └── pages.json
</code></pre>

<p>And correspondingly for any markdown content:</p>

<pre class="highlight plaintext"><code>apps/my-hof-form/views
└─┬ content/
  ├─┬ en/
  │ └── free-text-content.md
  └─┬ cy/
    └── free-text-content.md
</code></pre>

<p>Your hof app will then detect the language the user has requested from the <code>Accept-language</code> headers on their request and serve the appropriate content.</p>

<h1 id="customising-behaviour">Customising Behaviour</h1>

<p>You will also see in your configuration that the <code>/confirm</code> step has an additional <code>behaviours</code> option. This defines some custom functionality for that step.</p>

<p>&ldquo;Behaviours&rdquo; are used to extend the default request pipeline from the <a href="https://github.com/ukhomeofficeforms/hof-form-controller">core form controller</a> with custom functionality for you app.</p>

<p>Before writing your own behaviours it is helpful to understand the request/response flow, and what the different methods are used for.</p>

<h2 id="the-request-pipeline">The request pipeline</h2>

<p>The underlying controller that handles the form GET/POST pipeline consists of a number of stages for form rendering and processing/validation that can be extended to perform advanced custom behaviour for your forms.</p>

<p>All of the pipeline methods are passed the request and response objects as arguments. Unless specified below, methods are also passed a callback as a third argument, which should be called with an <code>Error</code> if applicable.</p>

<h3 id="get">GET</h3>

<p>The request/response flow for a GET request to a form step is as follows:</p>

<pre class="highlight plaintext"><code>configure ⇒ getValues ⇒ locals ⇒ render
</code></pre><h3 id="post">POST</h3>
<p>The request/response flow for a POST request to a form step is as follows:</p>
<pre class="highlight plaintext"><code>configure ⇒ process ⇒ validate ⇒ saveValues ⇒ successHandler
</code></pre><h4 id="configure"><code>configure</code></h4>
<p>The configure method is used on both GET and POST requests and can be used to override the global form configuration with request/session specifc details.</p>

<p>The initial controller configuration - as defined in your steps file - is available on <code>req.form.options</code> and can be written to or modified with any custom step or field configuration.</p>
<h4 id="getvalues"><code>getValues</code></h4>
<p>Retrieves any values required for this step. By default this is a copy of the data stored on the user&rsquo;s session.</p>

<p>This method is passed a callback as a third argument, which should be called with an error if required and the values as a second argument. Any values passed to the callback are written to <code>req.form.values</code>.</p>
<h4 id="locals"><code>locals</code></h4>
<p>Loads any data which is required to render the page template. Any values should be returned synchronously as a set of key-value pairs.</p>
<h4 id="render"><code>render</code></h4>
<p>Uses Mustache to render the step html to the user. It is unlikely that you would need to modify this method unless you wish to return non-html - e.g. if rendering a PDF file.</p>
<h4 id="process"><code>process</code></h4>
<p>Normalises the input data from <code>req.body</code> and writes any data to <code>req.form.values</code> to be consumed by later steps.</p>
<h4 id="validate"><code>validate</code></h4>
<p>Perform any custom validation required. By default all the fields are validated according to the rules defined in the field configuration (or custom rules defined in <code>configure</code>).</p>
<h4 id="savevalues"><code>saveValues</code></h4>
<p>Saves the processed values from the form to persistent storage for later retrieval. By default this writes the values from <code>req.form.values</code> to the user&rsquo;s session.</p>
<h4 id="successhandler"><code>successHandler</code></h4>
<p>Performs post-success actions on the form. By default this redirects the user to the subsequent form step.</p>
<h3 id="sessions">Sessions</h3>
<p>The user&rsquo;s session can be accessed at any time via <code>req.sessionModel</code>, with <code>get</code>, <code>set</code>, and <code>unset</code> methods available.</p>
<h2 id="behaviours">Behaviours</h2>
<p>To add a custom behaviour to a form step, you can set a <code>behaviours</code> option on the step configuration (note that this <em>cannot</em> be done dynamically, and must be hard-coded in the step configuration).</p>

<p>Behaviours can either be loaded from external modules (for example <a href="https://github.com/UKHomeOfficeForms/hof-behaviour-summary-page">hof-behaviour-summary-page</a> or <a href="https://github.com/UKHomeOfficeForms/hof-behaviour-address-lookup">hof-behaviour-address-lookup</a>) or from files within your own codebase. The patterns are the same in each case.</p>

<p>The <code>behaviours</code> option can be set with either a single behaviour directly, or as an array of behaviours which are composed upon one another. If multiple behaviours are passed then they are composed onto the base controller from left-to-right, so each behaviour will have methods from the previous behaviours available as <code>super</code>.</p>
<h3 id="writing-a-behaviour">Writing a behaviour</h3>
<p>The simplest form of a behaviour is a <a href="https://www.npmjs.com/package/mixwith#define-a-mixin">mixin function</a>, which takes a class as an argument, and extends it with custom methods.</p>
<pre class="highlight javascript"><code><span class="c1">// my-behaviour.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">superclass</span> <span class="o">=&gt;</span> <span class="kr">class</span> <span class="kr">extends</span> <span class="nx">superclass</span> <span class="p">{</span>
  <span class="nx">configure</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// do some custom configuration here</span>
      <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>

<p>You can then apply this behaviour to a step as follows:</p>

<pre class="highlight javascript"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">steps</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'/my-step'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">behaviours</span><span class="p">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./my-behaviour'</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre><h3 id="configurable-behaviours">Configurable behaviours</h3>
<p>In most cases, we will want custom behaviours to be configurable - for example, the <a href="https://github.com/UKHomeOfficeForms/hof-behaviour-emailer">emailer behaviour</a> - so the same behaviour can be re-used with different options.</p>

<p>In this case we can define our behaviour as a function which receives configuration options and returns a mixin function.</p>
<pre class="highlight javascript"><code><span class="c1">// reverse-a-key.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span> <span class="o">=&gt;</span> <span class="nx">superclass</span> <span class="o">=&gt;</span> <span class="kr">class</span> <span class="kr">extends</span> <span class="nx">superclass</span> <span class="p">{</span>
  <span class="nx">saveValues</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="s2">`</span><span class="p">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">key</span><span class="p">}</span><span class="s2">-reversed`</span><span class="p">]</span> <span class="o">=</span> <span class="nx">reverse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">config</span><span class="p">.</span><span class="nx">key</span><span class="p">]);</span>
    <span class="kr">super</span><span class="p">.</span><span class="nx">saveValues</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>

<p>You can then apply this behaviour to a step as follows:</p>

<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">reverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./reverse-a-key'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">steps</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'/my-step'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">],</span>
      <span class="na">behaviours</span><span class="p">:</span> <span class="nx">reverse</span><span class="p">({</span> <span class="na">key</span><span class="p">:</span> <span class="s1">'name'</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre><h3 id="completion-behaviour">Completion behaviour</h3>
<p>In addition to any custom behaviours, hof ships with a &ldquo;complete&rdquo; behaviour out of the box. Adding this behaviour to a step means that once it has been successfully submitted the user&rsquo;s session is marked as complete, and they cannot go back to earlier steps, only access the immediately subsequent step.</p>

<p>This can be set on a step by simply setting the string <code>&#39;complete&#39;</code> as a behaviour. It would be expected that this would normally run in conjunction with a behaviour that extends <code>saveValues</code> to submit the user&rsquo;s application.</p>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">submit</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./my-submission-behaviour'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">steps</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'/declaration'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">behaviours</span><span class="p">:</span> <span class="p">[</span><span class="s1">'complete'</span><span class="p">,</span> <span class="nx">submit</span><span class="p">],</span>
      <span class="na">next</span><span class="p">:</span> <span class="s1">'/confirmation'</span>
    <span class="p">},</span>
    <span class="s1">'/confirmation'</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// only this step can be accessed once "declaration" step is submitted</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>

<h1 id="api-integration">API integration</h1>

<h1 id="contributing-to-hof">Contributing to HOF</h1>

          </main>

          <footer class="footer">
  <div class="footer__licence">
    <a class="footer__licence-logo" href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence</a>
    <p class="footer__licence-description">All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence v3.0</a>, except where otherwise stated</p>
  </div>

  <div class="footer__copyright">
    <a class="footer__copyright-logo" href="http://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/copyright-and-re-use/crown-copyright/">© Crown copyright</a>
  </div>
</footer>

        </div>
      </div>
    </div>

    
  </body>
</html>
